"""
Конфигурация приложения и работа с переменными окружения.

Модуль отвечает за:
- загрузку настроек из файла .env с помощью python-dotenv;
- централизованное хранение конфигурационных параметров приложения;
- валидацию критичных переменных окружения перед запуском бота.

Основная точка входа — класс Config. Перед запуском приложения рекомендуется
вызвать Config.validate(), чтобы гарантировать наличие всех обязательных
параметров (например, TELEGRAM_TOKEN).
"""

from pathlib import Path
from typing import Final
from dotenv import load_dotenv
import os


# Загружаем переменные окружения из .env один раз при импорте модуля.
load_dotenv()


class Config:
    """
    Централизованная конфигурация приложения.

    Читает значения из переменных окружения и предоставляет их как статические
    атрибуты класса. Такой подход упрощает доступ к настройкам и делает код
    явно зависящим от конфигурации.

    Attributes
    ----------
    TELEGRAM_TOKEN : str
        Токен Telegram‑бота, полученный у @BotFather. Обязательный параметр,
        без него бот не сможет запуститься.
    DB_PATH : Path
        Путь к базе данных с расходами. Если переменная окружения DB_PATH
        не задана — используется файл 'expenses.db' в текущей директории.
    """

    TELEGRAM_TOKEN: Final[str] = os.getenv("TELEGRAM_TOKEN", "")
    DB_PATH: Final[Path] = Path(os.getenv("DB_PATH", "expenses.db"))

    @classmethod
    def validate(cls) -> None:
        """
        Проверить наличие обязательных переменных окружения.

        Выполняет минимальную валидацию конфигурации перед запуском приложения.
        В случае отсутствия критичных параметров (например, TELEGRAM_TOKEN)
        выбрасывает ValueError с человекочитаемым описанием проблемы.

        Raises
        ------
        ValueError
            Если не найден TELEGRAM_TOKEN в окружении или .env файле.
        """
        if not cls.TELEGRAM_TOKEN:
            raise ValueError("❌ TELEGRAM_TOKEN не найден в .env!")
